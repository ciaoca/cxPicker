/**
 * cxPicker
 * @version 1.0.1
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxPicker
 * @license Released under the MIT license
 */
!function(){const e={dom:{},init:function(){const s=this;s.loopTime=100,s.dom.wrap=document.createElement("div"),s.dom.wrap.classList.add("cxpicker"),s.dom.wrap.innerHTML=`<div class="mask"></div><div class="box"><div class="acts"><a class="cancel" href="javascript://" rel="cxpicker_hide"></a><a class="set" href="javascript://" rel="cxpicker_set"></a></div><div class="list"></div></div></div>`,s.dom.list=s.dom.wrap.querySelector(".list"),"ontouchend"in document.documentElement?s.dom.list.addEventListener("touchend",()=>{s.checkStable()}):s.dom.list.addEventListener("mousewheel",()=>{clearTimeout(s.scrollThrottle),s.scrollThrottle=setTimeout(()=>{s.checkStable()},s.loopTime)}),s.dom.wrap.addEventListener("click",e=>{const t=e.target;e=t.nodeName.toLowerCase();if("a"===e)switch(t.rel){case"cxpicker_hide":event.preventDefault(),s.hide();break;case"cxpicker_set":event.preventDefault(),s.confirm()}else if("div"===e)for(var o of t.classList)if("mask"===o){s.hide();break}}),document.body.insertAdjacentElement("beforeend",s.dom.wrap)},setOptions:function(e){var t=this;t.options=Object.assign({},o.defaults,e),"string"==typeof t.options.jsonValue&&t.options.jsonValue.length||(t.options.jsonValue=t.options.jsonName)},attach:function(e){var t=this;t.setOptions(e),Array.isArray(t.options.data)?(0===t.options.selectLength&&(t.options.selectLength=t.options.data.length),t.cacheSelect=[],t.cacheResult=[],t.subStart=null,t.buildSelect(),t.show()):console.warn("[cxPicker] data is not array.")},buildSelect:function(){var e,a=this;let t,o="";for(let s=0;s<a.options.selectLength;s++){let o;const c={index:0};if((o=Array.isArray(t)?t:0<a.options.data.length-s?a.options.data[s]:[]).length&&0<a.options.value.length-s)for(let e=0,t=o.length;e<t;e++)if(o[e]===a.options.value[s]||"object"==typeof o[e]&&o[e][a.options.jsonValue]===a.options.value[s]){c.index=e,"object"==typeof o[e]?(c.label=o[e][a.options.jsonName],c.value=o[e][a.options.jsonValue]):(c.label=o[e],c.value=o[e]);break}void 0===c.value&&("object"==typeof o[0]?(c.label=o[0][a.options.jsonName],c.value=o[0][a.options.jsonValue]):(c.label=o[0],c.value=o[0])),t="object"==typeof o[c.index]&&Array.isArray(o[c.index][a.options.jsonSub])?o[c.index][a.options.jsonSub]:null,Array.isArray(t)&&("number"!=typeof a.subStart||s<a.subStart)&&(a.subStart=s),a.cacheSelect.push(o),a.cacheResult.push(c)}for(e of a.cacheSelect)o+=a.createList(e);a.dom.list.innerHTML=o;const s=a.dom.list.getElementsByTagName("ul");a.itemHeight=a.dom.list.getElementsByTagName("li")[0].offsetHeight;for(let e=0,t=a.cacheResult.length;e<t;e++)a.cacheResult[e].top=a.itemHeight*a.cacheResult[e].index,s[e].scrollTop=a.cacheResult[e].top},createList:function(e){var t;const o=[];for(t of e)o.push(this.createItem(t));return"<section><ul>"+o.join("")+"</ul></section>"},createItem:function(e){let t="";return t="object"==typeof e?'<li data-value="'+e[this.options.jsonValue]+'">'+e[this.options.jsonName]+"</li>":'<li data-value="'+e+'">'+e+"</li>"},show:function(){this.dom.wrap.classList.remove("out"),this.dom.wrap.classList.add("in")},hide:function(){this.dom.wrap.classList.remove("in"),this.dom.wrap.classList.add("out")},confirm:function(){var e=this;e.checkStable(!0),"function"==typeof e.options.callback&&e.options.callback(e.getResult()),e.hide()},checkStable:function(e){const o=this;var s=o.dom.list.getElementsByTagName("ul");let a=!0;if(e&&(o.checkLock=!1),!o.checkLock){clearTimeout(o.checkLoop);for(let e=0,t=s.length;e<t;e++)if(s[e].scrollTop!==o.cacheResult[e].top){s[e].scrollTop>o.cacheResult[e].top?o.cacheResult[e].index=Math.ceil(s[e].scrollTop/o.itemHeight):o.cacheResult[e].index=Math.floor(s[e].scrollTop/o.itemHeight),o.cacheResult[e].top=s[e].scrollTop,a=!1;break}if(!a&&!e)return o.checkLock=!0,void(o.checkLoop=setTimeout(()=>{o.checkLock=!1,o.checkStable()},o.loopTime));o.checkSelect()}},checkSelect:function(){var a=this;const c=a.dom.list.getElementsByTagName("ul");for(let s=0;s<a.options.selectLength;s++){var l=a.cacheResult[s].index,n=a.cacheResult[s].value,i=a.cacheSelect[s][l],l=l*a.itemHeight;let e,t,o;c[s].scrollTop!==l&&(c[s].scrollTop=l),e="object"==typeof i?(t=i[a.options.jsonName],o=i[a.options.jsonValue],Array.isArray(i[a.options.jsonSub])?i[a.options.jsonSub]:null):(t=i,o=i,null),Array.isArray(e)&&("number"!=typeof a.subStart||s<a.subStart)&&(a.subStart=s),n!==o&&(a.cacheResult[s].label=t,a.cacheResult[s].value=o,"number"==typeof a.subStart&&a.subStart<=s&&a.clearSelect(s))}},clearSelect:function(e){var t=this;const o=t.dom.list.getElementsByTagName("section");var s=e+1;let a;Array.isArray(t.cacheSelect[e][t.cacheResult[e].index][t.options.jsonSub])&&(a=t.cacheSelect[e][t.cacheResult[e].index][t.options.jsonSub]),t.cacheSelect.splice(s,t.options.selectLength-e),t.cacheResult.splice(s,t.options.selectLength-e);for(let e=s;e<t.options.selectLength;e++){const c={index:0};"object"==typeof(a=Array.isArray(a)?a:[])[0]?(c.label=a[0][t.options.jsonName],c.value=a[0][t.options.jsonValue]):(c.label=a[0],c.value=a[0]),t.cacheSelect.push(a),t.cacheResult.push(c),o[e].insertAdjacentHTML("afterend",t.createList(a)),t.dom.list.removeChild(o[e]),a="object"==typeof a[c.index]&&Array.isArray(a[c.index][t.options.jsonSub])?a[c.index][t.options.jsonSub]:null}},getResult:function(){var e;const t={label:[],value:[]};for(e of this.cacheResult){if("object"==typeof e&&void 0===e.value)break;t.label.push(e.label),t.value.push(e.value)}return t}},o=function(){return o.attach.apply(o,arguments)};o.attach=function(){e.attach.apply(e,arguments)},o.defaults={value:[],selectLength:0,jsonName:"n",jsonValue:"v",jsonSub:"s"},document.addEventListener("DOMContentLoaded",()=>{e.init()}),window.cxPicker=o}();